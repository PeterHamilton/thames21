/**
 * Unobtrusive scripting adapter for jQuery
 *
 * Requires jQuery 1.4.4 or later.
 * https://github.com/rails/jquery-ujs

 * Uploading file using rails.js
 * =============================
 *
 * By default, browsers do not allow files to be uploaded via AJAX. As a result, if there are any non-blank file fields
 * in the remote form, this adapter aborts the AJAX submission and allows the form to submit through standard means.
 *
 * The `ajax:aborted:file` event allows you to bind your own handler to process the form submission however you wish.
 *
 * Ex:
 *     $('form').live('ajax:aborted:file', function(event, elements){
 *       // Implement own remote file-transfer handler here for non-blank file inputs passed in `elements`.
 *       // Returning false in this handler tells rails.js to disallow standard form submission
 *       return false;
 *     });
 *
 * The `ajax:aborted:file` event is fired when a file-type input is detected with a non-blank value.
 *
 * Third-party tools can use this hook to detect when an AJAX file upload is attempted, and then use
 * techniques like the iframe method to upload the file instead.
 *
 * Required fields in rails.js
 * ===========================
 *
 * If any blank required inputs (required="required") are detected in the remote form, the whole form submission
 * is canceled. Note that this is unlike file inputs, which still allow standard (non-AJAX) form submission.
 *
 * The `ajax:aborted:required` event allows you to bind your own handler to inform the user of blank required inputs.
 *
 * !! Note that Opera does not fire the form's submit event if there are blank required inputs, so this event may never
 *    get fired in Opera. This event is what causes other browsers to exhibit the same submit-aborting behavior.
 *
 * Ex:
 *     $('form').live('ajax:aborted:required', function(event, elements){
 *       // Returning false in this handler tells rails.js to submit the form anyway.
 *       // The blank required inputs are passed to this function in `elements`.
 *       return ! confirm("Would you like to submit the form with missing info?");
 *     });
 */
(function(a){var b;a.rails=b={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required],textarea[name][required]",fileInputSelector:"input:file",CSRFProtection:function(b){var c=a('meta[name="csrf-token"]').attr("content");c&&b.setRequestHeader("X-CSRF-Token",c)},fire:function(b,c,d){var e=a.Event(c);return b.trigger(e,d),e.result!==!1},confirm:function(a){return confirm(a)},ajax:function(b){return a.ajax(b)},handleRemote:function(c){var d,e,f,g=c.data("type")||a.ajaxSettings&&a.ajaxSettings.dataType;if(b.fire(c,"ajax:before")){if(c.is("form")){d=c.attr("method"),e=c.attr("action"),f=c.serializeArray();var h=c.data("ujs:submit-button");h&&(f.push(h),c.data("ujs:submit-button",null))}else d=c.data("method"),e=c.attr("href"),f=null;b.ajax({url:e,type:d||"GET",data:f,dataType:g,beforeSend:function(a,d){return d.dataType===undefined&&a.setRequestHeader("accept","*/*;q=0.5, "+d.accepts.script),b.fire(c,"ajax:beforeSend",[a,d])},success:function(a,b,d){c.trigger("ajax:success",[a,b,d])},complete:function(a,b){c.trigger("ajax:complete",[a,b])},error:function(a,b,d){c.trigger("ajax:error",[a,b,d])}})}},handleMethod:function(b){var c=b.attr("href"),d=b.data("method"),e=a("meta[name=csrf-token]").attr("content"),f=a("meta[name=csrf-param]").attr("content"),g=a('<form method="post" action="'+c+'"></form>'),h='<input name="_method" value="'+d+'" type="hidden" />';f!==undefined&&e!==undefined&&(h+='<input name="'+f+'" value="'+e+'" type="hidden" />'),g.hide().append(h).appendTo("body"),g.submit()},disableFormElements:function(c){c.find(b.disableSelector).each(function(){var b=a(this),c=b.is("button")?"html":"val";b.data("ujs:enable-with",b[c]()),b[c](b.data("disable-with")),b.attr("disabled","disabled")})},enableFormElements:function(c){c.find(b.enableSelector).each(function(){var b=a(this),c=b.is("button")?"html":"val";b.data("ujs:enable-with")&&b[c](b.data("ujs:enable-with")),b.removeAttr("disabled")})},allowAction:function(a){var c=a.data("confirm"),d=!1,e;return c?(b.fire(a,"confirm")&&(d=b.confirm(c),e=b.fire(a,"confirm:complete",[d])),d&&e):!0},blankInputs:function(b,c,d){var e=a(),f,g=c||"input,textarea";return b.find(g).each(function(){f=a(this);if(d?f.val():!f.val())e=e.add(f)}),e.length?e:!1},nonBlankInputs:function(a,c){return b.blankInputs(a,c,!0)},stopEverything:function(a){return a.stopImmediatePropagation(),!1},callFormSubmitBindings:function(b){var c=b.data("events"),d=!0;return c!==undefined&&c.submit!==undefined&&a.each(c.submit,function(a,b){if(typeof b.handler=="function")return d=b.handler(b.data)}),d}},"ajaxPrefilter"in a?a.ajaxPrefilter(function(a,c,d){b.CSRFProtection(d)}):a(document).ajaxSend(function(a,c){b.CSRFProtection(c)}),a(b.linkClickSelector).live("click.rails",function(c){var d=a(this);if(!b.allowAction(d))return b.stopEverything(c);if(d.data("remote")!==undefined)return b.handleRemote(d),!1;if(d.data("method"))return b.handleMethod(d),!1}),a(b.formSubmitSelector).live("submit.rails",function(c){var d=a(this),e=d.data("remote")!==undefined,f=b.blankInputs(d,b.requiredInputSelector),g=b.nonBlankInputs(d,b.fileInputSelector);if(!b.allowAction(d))return b.stopEverything(c);if(f&&b.fire(d,"ajax:aborted:required",[f]))return!e;if(e)return g?b.fire(d,"ajax:aborted:file",[g]):!a.support.submitBubbles&&b.callFormSubmitBindings(d)===!1?b.stopEverything(c):(b.handleRemote(d),!1);setTimeout(function(){b.disableFormElements(d)},13)}),a(b.formInputClickSelector).live("click.rails",function(c){var d=a(this);if(!b.allowAction(d))return b.stopEverything(c);var e=d.attr("name"),f=e?{name:e,value:d.val()}:null;d.closest("form").data("ujs:submit-button",f)}),a(b.formSubmitSelector).live("ajax:beforeSend.rails",function(c){this==c.target&&b.disableFormElements(a(this))}),a(b.formSubmitSelector).live("ajax:complete.rails",function(c){this==c.target&&b.enableFormElements(a(this))})})(jQuery),window.log=function(){log.history=log.history||[],log.history.push(arguments),this.console&&(arguments.callee=arguments.callee.caller,console.log(Array.prototype.slice.call(arguments)))},function(a){function b(){}for(var c="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),d;d=c.pop();)a[d]=a[d]||b}(window.console=window.console||{}),function(a){function e(c){function n(){c?f.removeData(c):k&&delete b[k]}function o(){g.id=setTimeout(function(){g.fn()},l)}var e=this,f,g={},h=c?a.fn:a,i=arguments,j=4,k=i[1],l=i[2],m=i[3];typeof k!="string"&&(j--,k=c=0,l=i[1],m=i[2]),c?(f=e.eq(0),f.data(c,g=f.data(c)||{})):k&&(g=b[k]||(b[k]={})),g.id&&clearTimeout(g.id),delete g.id;if(m)g.fn=function(a){typeof m=="string"&&(m=h[m]),m.apply(e,d.call(i,j))===!0&&!a?o():n()},o();else{if(g.fn)return l===undefined?n():g.fn(l===!1),!0;n()}}"$:nomunge";var b={},c="doTimeout",d=Array.prototype.slice;a[c]=function(){return e.apply(window,[0].concat(d.call(arguments)))},a.fn[c]=function(){var a=d.call(arguments),b=e.apply(this,[c+a[0]].concat(a));return typeof a[0]=="number"||typeof a[1]=="number"?this:b}}(jQuery),function(a){function b(b){if(a.facebox.settings.inited)return!0;a.facebox.settings.inited=!0,a(document).trigger("init.facebox"),e();var c=a.facebox.settings.imageTypes.join("|");a.facebox.settings.imageTypesRegexp=new RegExp("\\.("+c+")(\\?.*)?$","i"),b&&a.extend(a.facebox.settings,b),a("body").append(a.facebox.settings.faceboxHtml);var d=[new Image,new Image];d[0].src=a.facebox.settings.closeImage,d[1].src=a.facebox.settings.loadingImage,a("#facebox").find(".b:first, .bl").each(function(){d.push(new Image),d.slice(-1).src=a(this).css("background-image").replace(/url\((.+)\)/,"$1")}),a("#facebox .close").click(a.facebox.close).append('<img src="'+a.facebox.settings.closeImage+'" class="close_image" title="close">')}function c(){var a,b;return self.pageYOffset?(b=self.pageYOffset,a=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(b=document.documentElement.scrollTop,a=document.documentElement.scrollLeft):document.body&&(b=document.body.scrollTop,a=document.body.scrollLeft),new Array(a,b)}function d(){var a;return self.innerHeight?a=self.innerHeight:document.documentElement&&document.documentElement.clientHeight?a=document.documentElement.clientHeight:document.body&&(a=document.body.clientHeight),a}function e(){var b=a.facebox.settings;b.loadingImage=b.loading_image||b.loadingImage,b.closeImage=b.close_image||b.closeImage,b.imageTypes=b.image_types||b.imageTypes,b.faceboxHtml=b.facebox_html||b.faceboxHtml}function f(b,c){if(b.match(/#/)){var d=window.location.href.split("#")[0],e=b.replace(d,"");if(e=="#")return;a.facebox.reveal(a(e).html(),c)}else b.match(a.facebox.settings.imageTypesRegexp)?g(b,c):h(b,c)}function g(b,c){var d=new Image;d.onload=function(){a.facebox.reveal('<div class="image"><img src="'+d.src+'" /></div>',c)},d.src=b}function h(b,c){a.facebox.jqxhr=a.get(b,function(b){a.facebox.reveal(b,c)})}function i(){return a.facebox.settings.overlay==0||a.facebox.settings.opacity===null}function j(){if(i())return;return a("#facebox_overlay").length==0&&a("body").append('<div id="facebox_overlay" class="facebox_hide"></div>'),a("#facebox_overlay").hide().addClass("facebox_overlayBG").css("opacity",a.facebox.settings.opacity).click(function(){a(document).trigger("close.facebox")}).fadeIn(200),!1}function k(){if(i())return;return a("#facebox_overlay").fadeOut(200,function(){a("#facebox_overlay").removeClass("facebox_overlayBG"),a("#facebox_overlay").addClass("facebox_hide"),a("#facebox_overlay").remove()}),!1}a.facebox=function(b,c){a.facebox.loading(b.settings||[]),b.ajax?h(b.ajax,c):b.image?g(b.image,c):b.div?f(b.div,c):a.isFunction(b)?b.call(a):a.facebox.reveal(b,c)},a.extend(a.facebox,{settings:{opacity:.2,overlay:!0,loadingImage:"/facebox/loading.gif",closeImage:"/facebox/closelabel.png",imageTypes:["png","jpg","jpeg","gif"],faceboxHtml:'    <div id="facebox" style="display:none;">       <div class="popup">         <div class="content">         </div>         <a href="#" class="close"></a>       </div>     </div>'},loading:function(){b();if(a("#facebox .loading").length==1)return!0;j(),a("#facebox .content").empty().append('<div class="loading"><img src="'+a.facebox.settings.loadingImage+'"/></div>'),a("#facebox").show().css({top:c()[1]+d()/10,left:a(window).width()/2-a("#facebox .popup").outerWidth()/2}),a(document).bind("keydown.facebox",function(b){return b.keyCode==27&&a.facebox.close(),!0}),a(document).trigger("loading.facebox")},reveal:function(b,c){a(document).trigger("beforeReveal.facebox"),c&&a("#facebox .content").addClass(c),a("#facebox .content").empty().append(b),a("#facebox .popup").children().fadeIn("normal"),a("#facebox").css("left",a(window).width()/2-a("#facebox .popup").outerWidth()/2),a(document).trigger("reveal.facebox").trigger("afterReveal.facebox")},close:function(){return a(document).trigger("close.facebox"),!1}}),a.fn.facebox=function(c){function d(){a.facebox.loading(!0);var b=this.rel.match(/facebox\[?\.(\w+)\]?/);return b&&(b=b[1]),f(this.href,b),!1}if(a(this).length==0)return;return b(c),this.bind("click.facebox",d)},a(document).bind("close.facebox",function(){a.facebox.jqxhr&&(a.facebox.jqxhr.abort(),a.facebox.jqxhr=null),a(document).unbind("keydown.facebox"),a("#facebox").fadeOut(function(){a("#facebox .content").removeClass().addClass("content"),a("#facebox .loading").remove(),a(document).trigger("afterClose.facebox")}),k()})}(jQuery),function(){this.module=function(a,b){var c,d;return typeof a=="string"&&(a=a.split(".")),c=this[d=a.shift()]||(this[d]={}),c.module||(c.module=this.module),a.length?c.module(a,b):b.call(c)},this.module("T21",function(){return this.locations=[],this.map=void 0})}.call(this),function(){var a,b,c,d,e;d=function(){return $.facebox.settings.closeImage="/assets/facebox/closelabel.png",$.facebox.settings.loadingImage="/assets/facebox/loading.gif",$("a[rel*=facebox]").facebox(),$(document).bind("loading.facebox",function(){var a;return a=$("#facebox .content").first(),a.removeAttr("class"),a.addClass("content")})},T21.fit_zoom=function(){var a,b,c,d,e,f,g;a=new google.maps.LatLngBounds,g=T21.locations;for(e=0,f=g.length;e<f;e++)d=g[e],c=d.getLocation(),b=new google.maps.LatLng(c.lat,c.lon),a.extend(b);return T21.map.fitBounds(a)},T21.loadTreasures=function(a,b){return a==null&&(a=T21.map),b==null&&(b="none"),T21.getTreasureJSON(T21.parseTreasureJSON,a,b)},T21.getTreasureJSON=function(a,b,c){return b==null&&(b=T21.map),c==null&&(c="none"),$.ajax("/treasures",{type:"GET",dataType:"json",data:{lat:T21.location.lat(),lon:T21.location.lng(),sort:c},error:function(a,b,c){return!1},success:function(c,d,e){return a(c,b),!0}})},T21.parseTreasureJSON=function(a,b){var c,d,e,f,g,h,i,j;b==null&&(b=T21.map),T21.markers=[],T21.info_windows=[],j=[];for(h=0,i=a.length;h<i;h++)f=a[h],g=new google.maps.LatLng(f.lat,f.lng),e=Math.floor(Math.random()*2)+1,f.hyperlink===""?c='<div class="infobox"><h1>'+f.name+'</h1><p><img class="info_img" src="/assets/thames/thames_'+e+'.jpg" />'+f.description+"</p></div>":c='<div class="infobox"><a href="'+f.hyperlink+'"><h1>'+f.name+'</h1></a><p><img class="info_img" src="/assets/thames/thames_'+e+'.jpg" />'+f.description+"</p></div>",d=new google.maps.Marker({map:T21.map,draggable:!1,animation:google.maps.Animation.DROP,position:g,html:c}),j.push(google.maps.event.addListener(d,"click",function(){return T21.infowindow.setContent(this.html),T21.infowindow.open(T21.map,this)}));return j},c=function(){return $("#main").height($(window).height()-80)},e=function(){var a,b;return a=new google.maps.LatLng(51.50243858499476,-0.07020938574214375),T21.location=a,b={zoom:14,center:T21.location,mapTypeId:google.maps.MapTypeId.ROADMAP},T21.map=new google.maps.Map(document.getElementById("map_canvas"),b),google.maps.event.addListener(T21.map,"center_changed",function(){return T21.location=T21.map.getCenter()})},b=function(){return $(".scrollable").bind("click",function(){return window.location.hash=$(this).attr("href")}),!1},$("#add_treasure_btn").click(function(){return a()}),$(".save_form").live("click",function(){var a,b,c,d;return b=$(this).parents("form:first"),a=$(b).serialize(),d=$(b).attr("action"),c=$(b).attr("method"),a+="&_method="+c,$.post(d,a,null,"script"),!1}),a=function(){var a;return a=T21.map.getCenter(),T21.newmarker=new google.maps.Marker({map:T21.map,draggable:!0,animation:google.maps.Animation.DROP,position:a,icon:"http://www.google.com/intl/en_us/mapfiles/ms/micons/blue-dot.png"}),$.get("/treasures/new",{lat:a.lat(),lng:a.lng()},function(a){return T21.infowindow.setContent(a),T21.infowindow.open(T21.map,T21.newmarker)}),google.maps.event.addListener(T21.newmarker,"click",function(){return marker.getAnimation()!==null?marker.setAnimation(null):marker.setAnimation(google.maps.Animation.BOUNCE)}),google.maps.event.addListener(T21.newmarker,"dragend",function(){var a;return a=T21.newmarker.getPosition(),$("#treasure_lat").val(a.lat()),$("#treasure_lng").val(a.lng())})},$(document).ready(function(){return $(".mobile")||(c(),$(window).resize(c)),d(),e(),T21.infowindow=new google.maps.InfoWindow,T21.location=T21.map.getCenter(),T21.loadTreasures(),b()})}.call(this);